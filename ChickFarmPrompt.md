

# 🐣 كتاكيت عبد المعطي - تطبيق Flutter شخصي لإدارة دفعات الكتاكيت

> أنشئ تطبيق Flutter يُدعى **"كتاكيت عبد المعطي"**، يُستخدم لإدارة دفعات الكتاكيت، تسجيل المصروفات، تسجيل الوفيات، وإجراء عمليات البيع.

> ✅ استخدم:

* **Clean Architecture**
* **Cubit** لإدارة الحالة
* **Hive** كقاعدة بيانات محلية
* **لغة عربية فقط** مع دعم RTL
* **تصميم Responsive** يناسب الموبايل والتابلت
* **تحديث لحظي** Real-time بدون الحاجة لعمل Refresh يدوي
* **أداء عالي جدًا** على الأجهزة الضعيفة

---

## 🧱 Tech Stack & Packages

| الجانب              | التقنية                          |
| ------------------- | -------------------------------- |
| Architecture        | Clean Architecture               |
| State Management    | Cubit (flutter\_bloc)            |
| Local DB            | Hive + hive\_flutter             |
| DI                  | GetIt                            |
| Responsive UI       | flutter\_screenutil + MediaQuery |
| Localization        | Arabic only (RTL)                |
| Performance Monitor | Flutter DevTools                 |

---

## 📦 Features

### 1. إدارة دفعات الكتاكيت (Batches)

* اسم الدفعة
* تاريخ التسجيل
* اسم المورد
* عدد الكتاكيت
* سعر شراء الكتكوت
* السعر الكلي للشراء (محسوب)
* السعر المستهدف للبيع
* السعر المتوقع الكلي للبيع (محسوب)
* ملحوظة اختيارية

---

### 2. الإضافات والمصروفات (Additions)

* اسم المصروف
* السعر

محسوب تلقائيًا:

* إجمالي المصروفات
* التكلفة الحقيقية لكل كتكوت

---

### 3. الوفيات (Deaths)

* تاريخ الوفاة
* عدد الوفيات

> خصم مباشر من الكمية المتبقية

---

### 4. المبيعات (Sales)

* اسم المشتري ✅
* اسم الدفعة ✅
* تاريخ البيع (تلقائي)
* عدد الكتاكيت المباعة ✅
* السعر لكل كتكوت ✅
* السعر الكلي (محسوب)
* المبلغ المدفوع
* الباقي (محسوب)
* ملحوظة

> خصم مباشر من المتبقي

---

### 5. إحصائيات شاملة لكل دفعة

* عدد الكتاكيت الكلي
* عدد الوفيات
* عدد المبيعات
* عدد الكتاكيت المتبقية
* إجمالي المصروفات
* إجمالي المبيعات
* الربح / الخسارة
* التكلفة الحقيقية للكتكوت

---

### 6. تحديث لحظي (Real-time)

* باستخدام Hive + ValueListenableBuilder أو BlocBuilder
* أي تعديل يظهر فورًا بدون refresh يدوي

---

## 🎨 تصميم واجهة المستخدم (UI & UX)

> الهدف: تجربة استخدام سهلة، سريعة، متوافقة مع اللغة العربية، وتناسب مزارع الكتاكيت حتى لو بيستخدم تليفون بـ 2 جيجا رام 🐔📱

### ✅ القواعد العامة:

* كل الشاشات **RTL**
* استخدام `flutter_screenutil` لتنسيق الأحجام حسب الشاشة
* Text direction → `TextDirection.rtl`
* الخط المستخدم: "Cairo" أو "Tajawal"
* جميع أرقام الإدخال (سعر، عدد، مصروف...) تفتح `Numeric keyboard`
* التأكد من أن كل شيء يظهر في الشاشات الصغيرة
* استخدم `const` في أكبر عدد ممكن من الـ Widgets

---

### 🧾 تصميمات أساسية:

#### 📋 شاشة الدفعات:

* قائمة `ListView.builder` تعرض:

  * اسم الدفعة
  * عدد الكتاكيت المتبقية
  * تاريخ التسجيل
* زر “➕” لإضافة دفعة
* اذا كان لا يوجد دفعات اضف شى ليعلم


#### ➕ شاشة إضافة دفعة:

* `Form` يشمل:
  * اسم
  * مورد
  * التاريخ (DatePicker)
  * عدد الكتاكيت
  * السعر
  * سعر الكتكوت
  * السعر المستهدف للبيع
* زر "إضافة"

#### 💸 شاشة المصروفات:

* حقل اسم المصروف
* السعر
* قائمة تعرض المصروفات الحالية مع الإجمالي

#### ☠️ شاشة الوفيات:

* حقل عدد الوفيات
* تاريخ (تلقائي أو اختياري)

#### 🛍️ شاشة المبيعات:

* اسم المشتري
* عدد الكتاكيت المباعة
* سعر البيع
* المبلغ المدفوع
* عرض الباقي تلقائيًا

#### 📊 شاشة الإحصائيات:

* مخطط بسيط أو جدول يوضح:

  * عدد الكتاكيت المتبقية
  * التكلفة الفعلية
  * الربح / الخسارة

---

## ⚡ الأداء (Performance Optimization)

> خلي الأداء يطير 🕊️ مش بس يعدي

### 🧠 قاعدة البيانات:

* استخدم `Hive.lazyBox` للبيانات الكبيرة
* حفظ البيانات بسلاسة مع أقل IO ممكن

### 🎯 إدارة الحالة:

* استخدم `buildWhen` داخل BlocBuilder لتقليل الـ rebuild
* Cubits منفصلة لكل Feature

### 🖼️ واجهة المستخدم:

* تجنب إعادة بناء الـ Widgets الكثيرة
* استخدم `ListView.builder` و `const Widgets`
* افصل الشاشة لمكونات صغيرة (Widgets صغيرة قابلة لإعادة الاستخدام)

### 🧪 الحسابات والإحصائيات:

* استخدم `Cubit` لعمل caching داخل `state`
* حساب القيم الثقيلة مرة واحدة عند تغيير البيانات فقط

### 🛑 التحذيرات:

| الشيء الممنوع                | ليه؟         |
| ---------------------------- | ------------ |
| setState في الشاشات الكبيرة  | Rebuild عالي |
| فتح نفس Hive Box أكتر من مرة | Memory Leak  |
| تحميل كل شيء دفعة واحدة      | Slowness     |
| حسابات متكررة داخل UI        | Kill the FPS |

---

## 🧠 Data Entities

```dart
class BatchEntity {
  String id;
  String name;
  DateTime date;
  String supplier;
  int chickCount;
  double chickBuyPrice;
  double chickSellPrice;
  String? note;
}
```

```dart
class AdditionEntity {
  String id;
  String batchId;
  String name;
  double cost;
}
```

```dart
class DeathEntity {
  String id;
  String batchId;
  int count;
}
```

```dart
class SaleEntity {
  String id;
  String batchId;
  String buyerName;
  DateTime date;
  int chickCount;
  double pricePerChick;
  double paidAmount;
  String? note;
}
```

---

## 📁 Folder Structure (Clean Architecture)

```
lib/
├── core/
│   ├── constants/
│   ├── helpers/
│   ├── theme/
│   ├── utils/
│   └── di/
├── features/
│   ├── batches/
│   ├── additions/
│   ├── deaths/
│   ├── sales/
├── shared/
│   ├── widgets/
│   ├── cubits/
└── main.dart
```

---

## 🧭 خطوات التنفيذ - Execution Roadmap

### 1️⃣ إعداد المشروع

* RTL support
* إضافة الحزم
* Hive init + تسجيل Adapters

### 2️⃣ Dependency Injection

* إنشاء service\_locator
* تسجيل UseCases، Repositories، Cubits، Boxes

### 3️⃣ Feature by Feature

* batches → additions → deaths → sales → stats

### 4️⃣ UI لكل ميزة

* Responsive + Arabic UX

### 5️⃣ الأداء

* Lazy loading
* Bloc optimization
* Caching
---


## 📊 **الحسابات التلقائية داخل التطبيق**
### 🟡 **داخل الدفعة (Batch):**

| العنصر                         | كيف يُحسب تلقائيًا                    |
| ------------------------------ | ------------------------------------- |
| ✅ **إجمالي سعر الشراء**        | `عدد الكتاكيت × سعر شراء الكتكوت`     |
| ✅ **إجمالي سعر البيع المتوقع** | `عدد الكتاكيت × السعر المستهدف للبيع` |

---

### 🟡 **في شاشة المصروفات (Additions):**

| العنصر                         | كيف يُحسب تلقائيًا                                           |
| ------------------------------ | ------------------------------------------------------------ |
| ✅ **إجمالي المصروفات**         | مجموع كل البنود الخاصة بالمصروفات                            |
| ✅ **التكلفة الحقيقية للكتكوت** | `(إجمالي المصروفات + إجمالي الشراء) ÷ عدد الكتاكيت المتبقية` |

> ✅ "عدد الكتاكيت المتبقية" يحسب تلقائيًا من:
>
> ```
> عدد الكتاكيت الأصلي - الوفيات - الكتاكيت المباعة
> ```

---

### 🟡 **في شاشة الوفيات (Deaths):**

| العنصر                      | كيف يُحسب تلقائيًا                     |
| --------------------------- | -------------------------------------- |
| ✅ **عدد الكتاكيت المتبقية** | - خصم الوفيات الجديدة من العدد المتبقي |

---

### 🟡 **في شاشة المبيعات (Sales):**

| العنصر                      | كيف يُحسب تلقائيًا                         |
| --------------------------- | ------------------------------------------ |
| ✅ **السعر الكلي للبيع**     | `عدد الكتاكيت المباعة × سعر البيع للكتكوت` |
| ✅ **الباقي (إن وُجد)**      | `السعر الكلي - المبلغ المدفوع`             |
| ✅ **عدد الكتاكيت المتبقية** | خصم عدد الكتاكيت المباعة من المتبقي        |

---

### 🟡 **في شاشة الإحصائيات (Statistics):**

| العنصر                        | كيف يُحسب تلقائيًا                                    |
| ----------------------------- | ----------------------------------------------------- |
| ✅ **إجمالي الشراء**           | `عدد الكتاكيت × سعر الشراء`                           |
| ✅ **إجمالي المبيعات**         | مجموع كل المبالغ المدفوعة في المبيعات                 |
| ✅ **إجمالي المصروفات**        | مجموع كل البنود في additions                          |
| ✅ **الربح / الخسارة**         | `إجمالي المبيعات - (إجمالي الشراء + المصروفات)`       |
| ✅ **التكلفة الفعلية للكتكوت** | `(إجمالي الشراء + المصروفات) ÷ عدد الكتاكيت المتبقية` |
| ✅ **عدد الكتاكيت المتبقية**   | `العدد الأصلي - الوفيات - المبيعات`                   |

---

## ✅ خلاصة:

كل الأرقام اللي فيها عمليات حسابية لازم **يحصلها أوتوماتيك حساب داخل Cubit** أو في `UseCase`، **وممنوع تمامًا تتحسب جوه الـ UI** عشان:

* الأداء
* القابلية للصيانة
* والاختبار (Testing)

